<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<!-- 
			This blog is powered by FLOW3 http://flow3.typo3.org 
		-->
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<f:base />
		<title>{blog.title}</title>
		<link rel="stylesheet" href="{f:uri.resource(path: 'Blog.css')}" type="text/css" media="all" />

		<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href='<f:uri.action action="index" controller="Post" format="rss.xml"/>' />
		<link rel='index' title='{blog.title}' href='<f:uri.action action="index" controller="Post" format="html" />' />
		<link rel="canonical" href='<f:uri.action action="index" controller="Post"/>' />

		<meta name="generator" content="FLOW3" />
	</head>
	<body>
		<div id="header">
			<h1 class="title"><f:link.action action="index" controller="Post" format="html">{blog.title}</f:link.action></h1>
			<p class="description">{blog.description}</p>
		</div>
		<div id="maincontainer">
			<div id="mainbox"><f:render section="mainbox" /></div>
			<div id="sidebox">
				<div class="blurb">
					<f:if condition="{blog.authorPicture}">
						<img src="{f:uri.resource(resource: blog.authorPicture)}" />
					</f:if>
					{blog.blurb}
				</div>
				<div class="feed-button"><f:link.action action="index" controller="Post" format="rss.xml"><img src="{f:uri.resource(path: 'Icons/SubscribeFeed.png')}" width="31" height="53" title="Subscribe to feed" /></f:link.action></div>
				<f:if condition="{recentPosts}">
					<h3>Recent Posts</h3>
					<ul>
						<f:for each="{recentPosts}" as="recentPost">
							<li><f:link.action action="show" controller="Post" arguments="{post: recentPost}">{recentPost.title}</f:link.action></li>
						</f:for>
					</ul>
				</f:if>
				<f:if condition="{blog.twitterUsername}">
					<div class="twitter">
						<script>
							window.onload = function() {
								var twitterUsername = '{blog.twitterUsername}';
								var url = 'http://api.twitter.com/1/statuses/user_timeline.json?screen_name=' + twitterUsername + '&count=1&include_rts=true&callback=twitterCallback';
								var script = document.createElement('script');
								script.setAttribute('src', url);
								document.body.appendChild(script);
							}
							function twitterCallback(obj) {
								var t_time = document.getElementById('tweet-time');
								var t_status = document.getElementById('tweet-status');
								var html = "";
								for (var i=0 ; i<3 && i<obj.length ; i++) {
									t_time.innerHTML = "Sent "+prettyDate(obj[i].created_at);
									t_time.setAttribute("style","color: #999999");
									t_status.innerHTML = obj[i].text;
								}
								elem.innerHTML = html;
							}
							function prettyDate(time){
								var date = new Date((time || "").replace(/-/g,"/").replace(/[TZ]/g," ")),
								diff = (((new Date()).getTime() - date.getTime()) / 1000),
								day_diff = Math.floor(diff / 86400);

								if ( isNaN(day_diff) || day_diff < 0 || day_diff >= 31 )
									return;

								return day_diff == 0 && (
								diff < 60 && "just now" ||
									diff < 120 && "1 minute ago" ||
									diff < 3600 && Math.floor( diff / 60 ) + " minutes ago" ||
									diff < 7200 && "1 hour ago" ||
									diff < 86400 && Math.floor( diff / 3600 ) + " hours ago") ||
									day_diff == 1 && "Yesterday" ||
									day_diff < 7 && day_diff + " days ago" ||
									day_diff < 31 && Math.ceil( day_diff / 7 ) + " weeks ago";
							}
						</script>
						<h3>Latest Tweet</h3>
						<p><span id="tweet-status"></span><br /><span id="tweet-time"></span><br />
						<a href="http://twitter.com/{blog.twitterUsername}">Follow me on Twitter</a></p>
					</div>
				</f:if>
			</div>
			<div class="clear"></div>
		</div>
		<div id="footer">
			<f:security.ifAuthenticated>
				<f:then>
					<f:link.action controller="Admin">Administration</f:link.action>
				</f:then>
				<f:else>
					<f:link.action controller="Admin">Login</f:link.action>
				</f:else>
			</f:security.ifAuthenticated>
			| <a href="http://flow3.typo3.org">Powered by FLOW3 <img src="{f:uri.resource(path: 'FLOW3-Logo-11px.png')}" width="11" height="11" /></a>
		</div>
	</body>
</html>